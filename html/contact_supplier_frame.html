<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
   <link rel="stylesheet" type="text/css" href="../css/api.css"/>

    <link rel="stylesheet" type="text/css" href="../css/mui.min.css"/>
    <link rel="stylesheet" type="text/css" href="../css/app.css"/>
    <link rel="stylesheet" type="text/css" href="../css/mui.picker.css"/>
    <link rel="stylesheet" type="text/css" href="../css/mui.poppicker.css"/>
    <link rel="stylesheet" type="text/css" href="../css/hui.css"/>
    <style>
    </style>
</head>
<body>
    <dl>
        <dt><span>*</span>Country/Region:</dt>
        <dd>
            <div id="countryPicker" class="HUI_Icons HUI_Icons_down" style="padding-top: 3px; border-radius: 10px; display: block; height: 30px; text-align: center; border: 1px solid #ddd; width: 100%;" >
                        --Select country/region--
             </div>
        </dd>
    </dl>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../script/mui.min.js"></script>
<script type="text/javascript" src="../script/mui.picker.js"></script>
<script type="text/javascript" src="../script/mui.poppicker.js"></script>
<script type="text/javascript" src="../script/hui.js"></script>
<script type="text/javascript" src="../script/huiForm.js"></script>
<script type="text/javascript" src="../script/jquery.cookie.min.js"></script>

<script type="text/javascript">
    var productID,Countries;
    apiready = function(){
        productID=api.pageParam.productID;
        getProductByID(productID);
    };


    function getProductByID(productID){
        //友好加载
        api.showProgress({
            style: 'default',
            animationType: 'fade',
            title: 'Loading...',
            text: 'Wait a moment...',
            modal: false
        });
        api.ajax({
            url: 'http://192.168.40.20:8090/api/mbgasgoo/get_ContactSupplier_Product/'+productID,
            method: 'get',
        },function(ret, err){
            if (ret) {
               
               var tmp=ret[0].Countries;
               Countries=[
               ];

               for (var i = 0; i <tmp.length; i++) {
                 var country={value:tmp[i].RefID,text:tmp[i].Name};
                 Countries[i]=country;
               }
               showCountry(Countries);
                // (function ($, doc, $$) {
                    
                //     $.init();
                //     $.ready(function () {
                //         var userPicker = new $.PopPicker({ buttons: ['Cancel', 'OK'] });
                //         userPicker.setData(Countries);
                //         var showUserPickerButton = doc.getElementById('countryPicker');
                //         //var userResult = doc.getElementById('userResult');
                //         showUserPickerButton.addEventListener('tap', function (event) {
                //             userPicker.show(function (items) {
                //                 //userResult.innerText = JSON.stringify(items[0]);
                //                 $$('#countryPicker').html(items[0].text);
                //                 //$$('#countryPicker').attr("data-value", items[0].value);
                //                 $$("#hdnCountry").val(items[0].value);
                //                 //changeCookie(items[0].value, "gs-mb-prodiqy-country");
                //                 //返回 false 可以阻止选择框的关闭
                //                 //return false;
                //             });
                //         }, false);
                //         hui.ready(function () { hui.formInit(); });
                //     });
                // })(mui, document, jQuery);
            } else {
                api.toast({
                    msg: 'Error',
                    duration: 4000,
                    location: 'bottom'
                });
            }
        });
        api.hideProgress();
    }


function showCountry(Countries){
    function huiFormCheckAttach() {
    //Check region
    var curRegion = $("#hdnCountry").val()//jQuery('#countryPicker').attr("data-value");
    if (curRegion == -1) {
        hui.toast('Please select the country/region of your country'); return false;
    }
    return true;
}

(function ($, doc, $$) {
    function changeCookie(cookieValue,cookieName) {
        if (cookieValue != null && cookieValue != "") {
            $$.cookie(cookieName, cookieValue, { expires: 1000 });
        } else if ($$.cookie(cookieName) != undefined && $$.cookie(cookieName) != "") {
            $$.removeCookie(cookieName);
        }
    }
    $.init();
    $.ready(function () {
        //普通示例
        var userPicker = new $.PopPicker({ buttons: ['Cancel', 'OK'] });
        userPicker.setData(Countries);
        var showUserPickerButton = doc.getElementById('countryPicker');
        //var userResult = doc.getElementById('userResult');
        showUserPickerButton.addEventListener('tap', function (event) {
            userPicker.show(function (items) {
                //userResult.innerText = JSON.stringify(items[0]);
                $$('#countryPicker').html(items[0].text);
                //$$('#countryPicker').attr("data-value", items[0].value);
                $$("#hdnCountry").val(items[0].value);
                changeCookie(items[0].value, "gs-mb-prodiqy-country");
                //返回 false 可以阻止选择框的关闭
                //return false;
            });
        }, false);

        if ($$.cookie('gs-mb-prodiqy-country') != undefined && $$.cookie('gs-mb-prodiqy-country') != "") {
            userPicker.pickers[0].setSelectedValue($$.cookie('gs-mb-prodiqy-country'));
            if (!!userPicker.getSelectedItems()[0])
            $$('#countryPicker').text(userPicker.getSelectedItems()[0].text);
            $$("#hdnCountry").val($$.cookie('gs-mb-prodiqy-country'));
        }
    });

    hui.ready(function () { hui.formInit(); });
    function submitNow() {
        if (huiFormCheck('#form1')) {
            hui.centerLoading();
            $$("#form1").submit();
        }
    }

    $$("#btnSubmit").click(function () {
        submitNow();
    });

    $$(function () {

        if ($$.cookie('gs-mb-prodiqy-email') != undefined && $$.cookie('gs-mb-prodiqy-email') != "") {
            $$("#txtEmail").val($$.cookie('gs-mb-prodiqy-email'));
        }
        if ($$.cookie('gs-mb-prodiqy-uname') != undefined && $$.cookie('gs-mb-prodiqy-uname') != "") {
            $$("#txtName").val($$.cookie('gs-mb-prodiqy-uname'));
        }

        $$("#txtEmail").on("input propertychange", function() { changeCookie(this.value,"gs-mb-prodiqy-email") });
        $$("#txtName").on("input propertychange", function() { changeCookie(this.value,"gs-mb-prodiqy-uname") });
       
    });
   
})(mui, document, jQuery);
}
</script>
<!-- <script type="text/javascript" src="../script/proiqr.js"></script> -->
</html>