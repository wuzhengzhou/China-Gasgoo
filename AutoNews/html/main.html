<!DOCTYPE html>
<html>


<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>main</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style>
        .header {
            height: 50px;
            background-color: #fff;
        }

        .header ul {
            display: -webkit-box;
            /* Chrome 4+, Safari 3.1, iOS Safari 3.2+ */
            -webkit-box-orient: horizontal;
            /* 虽然默认的排列方式是水平的，但是为了区分起见，加上该属性 */
            display: -webkit-flex;
            /* Chrome 21+, Safari 6.1+, iOS Safari 7+, Opera 15/16 */
            display: flex;
            /* Chrome 29+, Firefox 22+, IE 11+, Opera 12.1/17/18, Android 4.4+ */
            -webkit-box-orient: horizontal;
            /*horizontal 设置伸缩盒对象的子元素从左到右水平排列 */
            -webkit-flex-flow: row;
            flex-flow: row;
            /* 属性是flex-direction属性和flex-wrap属性的简写形式，默认值为row nowrap.   row（默认值）主轴为水平方向，起点在左端*/
        }

        .header ul li {
            box-sizing: border-box;
        }

        .news .search {
            width: 55px;
            margin-top: 5px;
        }

        .news .search a {
            background: url(../image/menu.png) no-repeat center;
            background-size: 25px;
            width: 30px;
            height: 30px;
            margin: 0px auto;
            display: block;
        }

        .return a {
            background: url(../image/his.png) no-repeat center !important;
            background-size: 11px !important;
        }

        .header .searchKuan {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            background: #edf1f4;
            margin-top: 7px;
            height: 27px;
            border-radius: 20px;
        }

        .header .searchKuan .inputSear {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-orient: horizontal;
            -webkit-flex-flow: row;
            flex-flow: row;
        }

        .header .searchKuan a {
            height: 27px;
            border-radius: 2em;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            padding: 0px 8px;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            font-size: 13px;
            line-height: 27px;
            color: #99a5ae;
        }

        .header .searchMagnifier {
            width: 55px;
            background: url(../image/search.png) no-repeat center;
            background-size: 25px;
            margin-top: 5px;
        }

        .hide {
            display: none;
        }
        /*b2b头部*/

        .b2b .searchMagnifier {
            width: 55px;
            background: url(../image/search.png) no-repeat center;
            background-size: 25px;
            margin-top: 5px;
        }

        .b2b .search {
            width: 10px;
            margin-top: 5px;
        }
    </style>
</head>

<body>
    <header id="header">
        <div class="header news">
            <ul>
                <li tapmode="hover" class="search" tapmode onclick="openSlid()">
                    <a></a>
                </li>
                <li class="searchKuan" onclick="openSeachBar('news')">
                    <div class="inputSear"><a> Search Gasgoo AutoNews</a></div>
                </li>
                <li class="searchMagnifier" onclick="openSeachBar('news')">
                    <a></a>
                </li>
            </ul>
        </div>
        <div class="header b2b">
            <ul>
                <li class="search">
                    <a></a>
                </li>
                <li class="searchKuan" onclick="openSeachBar('b2b')">
                    <div class="inputSear"><a> Search Gasgoo B2B</a></div>
                </li>
                <li class="searchMagnifier" onclick="openSeachBar('b2b')">
                    <a></a>
                </li>
            </ul>
        </div>
        <div class="header mine hide"></div>
    </header>
    <footer>
        <div class="footerNav">
            <ul>
            </ul>
        </div>
    </footer>
</body>
<script type="text/template" id="tmp_NavList">
    {{~it:value:index}}
    <li tapmode>
        <a tapmode onclick="randomSwitchBtn(this)" style="color:{{=value.Color}}" data-Color="{{=value.Color}}" data-selectedColor="{{=value.SelectedColor}}">
            <span></span> {{=value.Name}}
        </a>
    </li>
    {{~}}
</script>
<script src="../script/api.js"></script>
<script src="../script/doT.min.js"></script>
<script>
    // 公共变量
    var headerH,
        footerH = 50,
        winWidth,
        winHeight;

    // UISearchBar独立搜索模块
    var UISearchBar;

    apiready = function() {
        init();
        getNavList();
        openFrameGroup();
    };

    // init.
    function init() {
        headerH = $api.offset($api.dom($api.byId('header'), '.header')).h + 20;

        $api.fixStatusBar($api.byId('header'));
        api.setStatusBarStyle({
            style: 'dark'
        });

        // 监听返回键
        api.addEventListener({
            name: 'keyback'
        }, function(ret, err) {
            api.closeWidget();
        });

        // 窗口宽高
        winWidth = api.winWidth;
        winHeight = api.winHeight;

        // 导入搜索模块
        UISearchBar = api.require("UISearchBar");
    }

    function getNavList() {
        api.ajax({
            url: 'https://api.gasgoo.com/api/autonews/get_nav_list',
            cache: true,
            method: 'get'
        }, function(ret, err) {
            if (ret) {
                // 获取模板
                var tmp_NavList = doT.template($api.byId('tmp_NavList').innerHTML);
                // 绑定数据
                $api.html($api.dom('.footerNav ul'), tmp_NavList(ret.data));
                $api.addCls($api.dom('.footerNav ul li:nth-child(1) a'), 'active');
                api.parseTapmode();
            }
        });
    }

    // FrameGroup
    function openFrameGroup() {
        api.openFrameGroup({
            name: 'group',
            background: '#fff',
            scrollEnabled: false,
            rect: {
                x: 0,
                y: headerH,
                w: 'auto',
                h: winHeight - headerH - footerH
            },
            index: 0,
            frames: [{
                name: 'news',
                url: 'news.html',
                bgColor: '#fff',
                bounces: true
            }, {
                name: 'b2b',
                url: 'b2b.html',
                bgColor: '#fff',
                bounces: true
            }, {
                name: 'mine',
                url: 'mine.html',
                bgColor: '#fff',
                bounces: false
            }]
        }, function(ret, err) {});
    }

    // 打开侧边栏
    function openSlid() {
        api.openSlidPane({
            type: 'left'
        });
    }

    function randomSwitchBtn(tag) {
        var footList = $api.domAll('.footerNav ul li a'),
            index = 0;
        var color = $api.attr(tag, 'data-Color');
        var selectedColor = $api.attr(tag, 'data-selectedColor');
        for (var i = 0; i < footList.length; i++) {
            if (tag == footList[i]) {
                index = i;
            } else {
                $api.removeCls(footList[i], 'active');
                $api.css(footList[i], 'color:' + color + '');
            }
        }
        $api.addCls(footList[index], 'active');
        $api.css(footList[index], 'color:' + selectedColor + '');
        setCurrentFrame(index)
    }

    // 设置FrameGroup属性
    function setCurrentFrame(index) {
        api.setFrameGroupIndex({
            name: 'group',
            index: index,
        });
        if (index == 0) {
            $api.removeCls($api.dom('.news'), 'hide');
            $api.addCls($api.dom('.b2b'), 'hide');
            api.setFrameGroupAttr({
                name: 'group',
                rect: {
                    x: 0,
                    y: headerH,
                    w: 'auto',
                    h: winHeight - headerH - footerH
                },
            });
            api.unlockSlidPane();
        } else if (index == 1) {
            $api.removeCls($api.dom('.b2b'), 'hide');
            $api.addCls($api.dom('.news'), 'hide');
            api.setFrameGroupAttr({
                name: 'group',
                rect: {
                    x: 0,
                    y: headerH,
                    w: 'auto',
                    h: winHeight - headerH - footerH
                },
            });
            api.lockSlidPane();
        } else {
            api.setFrameGroupAttr({
                name: 'group',
                rect: {
                    x: 0,
                    y: 0,
                    w: 'auto',
                    h: winHeight - footerH
                },
            });
            api.lockSlidPane();
        }
    }

    // SeachBar
    function openSeachBar(type) {
        if (type == 'news') {
            UISearchBar.open({
                placeholder: 'Search',
                historyCount: 10,
                showRecordBtn: false,
                texts: {
                    cancelText: 'Cancel',
                    clearText: 'Clear history'
                },
                styles: {
                    navBar: {
                        bgColor: '#fff',
                        borderColor: '#fff'
                    },
                    searchBox: {
                        bgImg: 'widget://image/searchbg.png',
                        color: '#000',
                        height: 40
                    },
                    cancel: {
                        bg: 'rgba(0,0,0,0)',
                        color: '#00568F',
                        size: 16
                    },
                    list: {
                        color: '#696969',
                        bgColor: '#FFF',
                        borderColor: '#eee',
                        size: 16
                    },
                    clear: {
                        color: '#000',
                        borderColor: '#ccc',
                        size: 16
                    }
                }
            }, function(ret, err) {
                if ($api.trim(ret.text) != '') {
                    openSearchList(ret.text, 'news_search_list');
                } else {
                    api.toast({
                        msg: 'Enter your keywords',
                        duration: 4000,
                        location: 'middle'
                    });
                }
            });
        } else {
            openSearchList('', 'b2b_search');
        }
    }

    // 打开搜索列表页
    function openSearchList(keyword, searchPage) {
        api.openWin({
            name: searchPage,
            url: './' + searchPage + '.html',
            pageParam: {
                keyword: keyword
            },
            animation: {
                trpe: 'fade'
            }
        });
    }
</script>

</html>
